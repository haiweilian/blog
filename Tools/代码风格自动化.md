---
title: 代码风格自动化
date: 2020-08-10
updated: 2020-08-10
categories: Tools
---

代码风格自动化、配置记录。

## 编码规范

### editorconfig

配置编辑器的规范。

在 `.editorconfig` 文件，添加以下内容。

```yml
root = true

[*]
indent_style = space
indent_size = 2
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.md]
trim_trailing_whitespace = false
```

vscode 插件 `EditorConfig for VS Code`。

### eslint

JavaScript 语法规则和代码风格的检查工具。

选择一个语法标准，如 `eslint-config-airbnb` 或者 `eslint-config-standard`，其它覆盖配置按文档配置。

```sh
npm install eslint eslint-config-airbnb-base eslint-plugin-import --save-dev
```

在 `.eslintrc` 文件，添加以下内容。

```json
{
  "root": true,
  "extends": ["airbnb-base"]
}
```

安装 vscode 插件 `ESLint`。添加 `.vscode/settings.json` 配置自动修复。

```json
{
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

### stylelint

Css 语法规则和代码风格的检查工具。

如可以做到语法上规范，书写顺序规范(盒模型->内容->其他)。

```sh
npm install stylelint stylelint-config-standard stylelint-order stylelint-config-recess-order --save-dev
```

在 `.stylelintrc` 文件，添加以下内容。

```json
{
  "extends": ["stylelint-config-standard", "stylelint-config-recess-order"],
  "plugins": ["stylelint-order"]
}
```

安装 vscode 插件 `stylelint`。添加 `.vscode/settings.json` 配置自动修复。

```json
{
  "editor.codeActionsOnSave": {
    "source.fixAll.stylelint": true
  }
}
```

### prettier

专注代码格式化的工具，eslint 更多的专注语法规则。

一般也是结合 eslint 用的，prettier 把检测的语法错误提示，交给 eslint 来处理。

```sh
npm install eslint-config-prettier eslint-plugin-prettier --save-dev
```

在 `.eslintrc` 文件，添加以下内容。

```json
{
  "extends": ["plugin:prettier/recommended"]
}
```

在 `.prettierrc` 文件，添加以下内容。

```json
{
  "semi": false,
  "singleQuote": true,
  "printWidth": 80
}
```

## 提交规范

### husky

Git Hook 工具，可以配合 `lint-staged` 、`commitlint` 等工具做钩子。

```sh
npm install husky --save-dev
```

在 `.huskyrc` 文件，添加以下内容。

```json
{
  "hooks": {
    "pre-commit": "lint-staged",
    "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
  }
}
```

### lintstaged

格式化 git 提交时缓存中的代码，实际上还是调用 `eslint` `stylelint` 等格式化工具。

```sh
npm install lint-staged --save-dev
```

在 `.lintstagedrc` 文件，添加以下内容。

```json
{
  "*.js": ["eslint --fix"],
  "*.scss": ["stylelint --fix"]
}
```

### commitlint

提交规范的校验。[约定式提交的规范](https://www.conventionalcommits.org/zh-hans)

```sh
npm install @commitlint/cli @commitlint/config-conventional --save-dev
```

在 `commitlint.config.js` 文件，添加以下内容。

```js
module.exports = {
  extends: ["@commitlint/config-conventional"],
};
```

### commitizen

格式化 commit message 的工具，终端交互的方法，这样就不必手动去拼接 commitlint 规范的格式了。

```sh
npm install commitizen --save-dev
```

```sh
npx commitizen init cz-conventional-changelog --save-dev --save-exact
```

在 `package.json` 的 `scripts` 字段添加 `commit` 命令，每次提交改用 `npm run commit`。

```json
"scripts": {
  "commit": "npx git-cz"
}
```

### standard-version

自动更改版本，生成日志。

```sh
npm install standard-version --save-dev
```

在 `package.json` 的 `scripts` 字段添加 `release` 命令，发布版本执行 `npm run release`。

```json
"scripts": {
  "release": "standard-version"
}
```
