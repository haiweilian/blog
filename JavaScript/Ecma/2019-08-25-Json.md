---
title: Json 相关知识
date: 2019-08-25
updated: 2019-08-25
categories: JavaScript
---

## JSON格式

JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式。

> JSON 是一种语法，用来序列化对象、数组、数值、字符串、布尔值 和 null 。它基于 JavaScript 语法，但与之不同：JavaScript不是JSON，JSON也不是JavaScript。

JSON建构于两种结构：

无序的 `{"key":"value"}` 键值对集合。`key` 必须是 "双引号"，如果值是字符串也必须是 "双引号"。

```javascript
let jsonObject = {
    "name": "lian",
    "age": 22,
    "status": true,
    "list": ["play", "status"]
}
```

有序列表 `["lian"]` 项集合。如果项是字符串必须是 "双引号"。

```javascript
let jsonArray = ["play", "status"]
```

## 序列化

我们可以使用 `JSON.stringify(value[, replacer [, space]])` 把普通的对象转化为 `json` 字符串。

定义一个对象，用作下面的示例。

```javascript
let jsonObject = {
    name: 'lian',
    age: 22,
    status: true,
    list: ['play', 'status']
}
```

第一个必传参数，序列的值。

```javascript
JSON.stringify(jsonObject)
```

```json
{"name":"lian","age":22,"status":true,"list":["play","status"]}
```

第二个可选参数，可以传入一个函数，这样对象的每个键值对都会被函数先处理。

```javascript
JSON.stringify(jsonObject, (key, value) => {
    if (typeof value === 'string') {
        return value.toUpperCase()
    }
    return value
})
```

```json
{"name":"LIAN","age":22,"status":true,"list":["PLAY","STATUS"]}
```

第三个可选参数，缩进用的空白字符串，格式化输出的字符串。

```javascript
JSON.stringify(jsonObject, null, '  ')
```

```json
{
  "name": "lian",
  "age": 22,
  "status": true,
  "list": [
    "play",
    "status"
  ]
}
```

## 反序列化

拿到一个JSON格式的字符串，我们直接用 `JSON.parse(text[, reviver])` 把它变成一个JavaScript对象。

定义一个json字符串，用作下面的示例。

```javascript
let jsonString = '{"name":"lian","age":22,"status":true}'
```

第一必传参数，用来转换解析json字符串。

```javascript
JSON.parse(jsonString)
```

```javascript
{
    age: 22,
    name: "lian",
    status: true
}
```

第二个可选参数，可以传入一个函数，这样对象的每个键值对都会被函数先处理。

```javascript
JSON.parse(jsonString, function (key, value) {
    if (typeof value === 'string') {
        return value.toUpperCase()
    }
    return value
})
```

```javascript
{
    age: 22,
    name: "LIAN",
    status: true
}
```

## 深拷贝

可以使用 `JSON.parse(JSON.stringify(value))` 进行深拷贝。不过不在json语法之内的类型，会出现问题。

- 函数、undefined丢失。
- date类型转换为时间字符串。
- 正则转化成了一个空对象。
- NaN、Infinity、-Infinity 会转成 null。

```javascript
let deepclone = {
    Infinity: Infinity,
    NaN: NaN,
    array: [1],
    boolean: true,
    date: new Date(),
    obj: {a: 1},
    reg: /123/,
    sex: 1,
    callback: () => {},
    undefined: undefined
}

JSON.parse(JSON.stringify(deepclone))

{
    Infinity: null,
    NaN: null,
    array: [1],
    boolean: true,
    date: "2019-09-02T12:46:16.355Z",
    obj: {a: 1},
    reg: {},
    sex: 1
}
```

## 参考链接

<http://www.json.org/json-zh.html>
<https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON>
